/*================================================================================
 * @name: bPopup - if you can't get it up, use bPopup
 * @author: (c)Bjoern Klinggaard (twitter@bklinggaard)
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.10.0.min
 ================================================================================*/
(function(a){a.fn.bPopup=function(t,D){if(a.isFunction(t)){D=t;t=null}var I=a.extend({},a.fn.bPopup.defaults,t);if(!I.scrollBar){a("html").css("overflow","hidden")}var f=this,P=a(document),E=window,Q=a(E),n=N(),j=L(),C="__b-popup",K=(/OS 6(_\d)+/i).test(navigator.userAgent),r=200,e=0,B,q,m,A,u,F,S,c,b,i,y;f.close=function(){G()};f.reposition=function(d){p(d)};return f.each(function(){if(a(this).data("bPopup")){return}J()});function J(){h(I.onOpen);e=(Q.data("bPopup")||0)+1,B=C+e+"__",m=I.position[1]!=="auto",A=I.position[0]!=="auto",u=I.positionStyle==="fixed",c=f.outerHeight(true),b=f.outerWidth(true);I.loadUrl?x():s()}function x(){I.contentContainer=a(I.contentContainer||f);switch(I.content){case ("iframe"):var d=a('<iframe class="b-iframe" '+I.iframeAttr+"></iframe>");d.appendTo(I.contentContainer);c=f.outerHeight(true);b=f.outerWidth(true);s();d.attr("src",I.loadUrl);h(I.loadCallback);break;case ("image"):s();a("<img />").load(function(){h(I.loadCallback);g(a(this))}).attr("src",I.loadUrl).hide().appendTo(I.contentContainer);break;default:s();a('<div class="b-ajax-wrapper"></div>').load(I.loadUrl,I.loadData,function(w,o,T){h(I.loadCallback,o);g(a(this))}).hide().appendTo(I.contentContainer);break}}function s(){if(I.modal){a('<div class="b-modal '+B+'"></div>').css({backgroundColor:I.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:I.zIndex+e}).appendTo(I.appendTo).fadeTo(I.speed,I.opacity)}v();f.data("bPopup",I).data("id",B).css({left:I.transition=="slideIn"||I.transition=="slideBack"?(I.transition=="slideBack"?P.scrollLeft()+j:(S+b)*-1):H(!(!I.follow[0]&&A||u)),position:I.positionStyle||"absolute",top:I.transition=="slideDown"||I.transition=="slideUp"?(I.transition=="slideUp"?P.scrollTop()+n:F+c*-1):l(!(!I.follow[1]&&m||u)),"z-index":I.zIndex+e+1}).each(function(){if(I.appending){a(this).appendTo(I.appendTo)}});O(true)}function G(d){if(I.modal){a(".b-modal."+f.data("id")).fadeTo(I.speed,0,function(){a(this).remove()})}R();clearTimeout(y);O();if(d){d.preventDefault()}}function p(d){n=N();j=L();q=z();if(q){clearTimeout(i);i=setTimeout(function(){v();d=d||I.followSpeed;f.dequeue().each(function(){if(u){a(this).css({left:S,top:F})}else{a(this).animate({left:I.follow[0]?H(true):"auto",top:I.follow[1]?l(true):"auto"},d,I.followEasing)}})},50)}}function g(T){var d=T.width(),w=T.height(),o={};I.contentContainer.css({height:w,width:d});if(w>=f.height()){o.height=f.height()}if(d>=f.width()){o.width=f.width()}c=f.outerHeight(true),b=f.outerWidth(true);v();I.contentContainer.css({height:"auto",width:"auto"});o.left=H(!(!I.follow[0]&&A||u)),o.top=l(!(!I.follow[1]&&m||u));f.animate(o,250,function(){T.show();q=z()})}function M(){Q.data("bPopup",e);f.delegate(".bClose, ."+I.closeClass,"click."+B,G);if(I.modalClose){a(".b-modal."+B).css("cursor","pointer").bind("click",G)}if(!K&&(I.follow[0]||I.follow[1])){Q.bind("scroll."+B,function(){if(q){f.dequeue().animate({left:I.follow[0]?H(!u):"auto",top:I.follow[1]?l(!u):"auto"},I.followSpeed,I.followEasing)}}).bind("resize."+B,function(){p()})}if(I.escClose){P.bind("keydown."+B,function(d){if(d.which==27){G(d)}})}}function R(){if(!I.scrollBar){a("html").css("overflow","auto")}a(".b-modal."+B).unbind("click");P.unbind("keydown."+B);Q.unbind("."+B).data("bPopup",(Q.data("bPopup")-1>0)?Q.data("bPopup")-1:null);f.undelegate(".bClose, ."+I.closeClass,"click."+B,G).data("bPopup",null)}function O(o){switch(o?I.transition:I.transitionClose||I.transition){case"slideIn":d({left:o?H(!(!I.follow[0]&&A||u)):P.scrollLeft()-(b||f.outerWidth(true))-r});break;case"slideBack":d({left:o?H(!(!I.follow[0]&&A||u)):P.scrollLeft()+j+r});break;case"slideDown":d({top:o?l(!(!I.follow[1]&&m||u)):P.scrollTop()-(c||f.outerHeight(true))-r});break;case"slideUp":d({top:o?l(!(!I.follow[1]&&m||u)):P.scrollTop()+n+r});break;default:f.stop().fadeTo(I.speed,o?1:0,function(){k(o)})}function d(w){f.css({display:"block",opacity:1}).animate(w,I.speed,I.easing,function(){k(o)})}}function k(d){if(d){M();h(D);if(I.autoClose){y=setTimeout(G,I.autoClose)}}else{f.hide();h(I.onClose);if(I.loadUrl){I.contentContainer.empty();f.css({height:"auto",width:"auto"})}}}function H(d){return d?S+P.scrollLeft():S}function l(d){return d?F+P.scrollTop():F}function h(o,d){a.isFunction(o)&&o.call(f,d)}function v(){F=m?I.position[1]:Math.max(0,((n-f.outerHeight(true))/2)-I.amsl),S=A?I.position[0]:(j-f.outerWidth(true))/2,q=z()}function z(){return n>f.outerHeight(true)&&j>f.outerWidth(true)}function N(){return E.innerHeight||Q.height()}function L(){return E.innerWidth||Q.width()}};a.fn.bPopup.defaults={amsl:50,appending:true,appendTo:"body",autoClose:false,closeClass:"b-close",content:"ajax",contentContainer:false,easing:"swing",escClose:true,follow:[true,true],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:false,loadData:false,loadUrl:false,modal:true,modalClose:true,modalColor:"#000",onClose:false,onOpen:false,opacity:0.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:true,speed:250,transition:"fadeIn",transitionClose:false,zIndex:9997}})(jQuery);