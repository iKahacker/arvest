/*!
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
(function(d,f){var e="selectbox",c=false,b=true;function a(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}d.extend(a.prototype,{_isOpenSelectbox:function(h){if(!h){return c}var g=this._getInst(h);return g.isOpen},_isDisabledSelectbox:function(h){if(!h){return c}var g=this._getInst(h);return g.isDisabled},_attachSelectbox:function(o,k){if(this._getInst(o)){return c}var j=d(o),t=this,m=t._newInst(j),l,r,i,p,u=c,h=j.find("option"),n=h.length;j.attr("sb",m.uid);d.extend(m.settings,t._defaults,k);t._state[m.uid]=c;j.hide();function g(){var v,w,s=this.attr("id").split("_")[1];for(v in t._state){if(v!==s){if(t._state.hasOwnProperty(v)){w=d("select[sb='"+v+"']")[0];if(w){t._closeSelectbox(w)}}}}}l=d("<div>",{id:"sbHolder_"+m.uid,"class":m.settings.classHolder,tabindex:j.attr("tabindex")});r=d("<a>",{id:"sbSelector_"+m.uid,href:"#","class":m.settings.classSelector,click:function(v){v.preventDefault();g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(t._state[s]){t._closeSelectbox(o)}else{t._openSelectbox(o)}},touchend:function(v){g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(t._state[s]){t._closeSelectbox(o)}else{t._openSelectbox(o)}}});i=d("<a>",{id:"sbToggle_"+m.uid,href:"#","class":m.settings.classToggle,click:function(v){v.preventDefault();g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(t._state[s]){t._closeSelectbox(o)}else{t._openSelectbox(o)}},touchend:function(v){g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(t._state[s]){t._closeSelectbox(o)}else{t._openSelectbox(o)}}});i.appendTo(l);p=d("<ul>",{id:"sbOptions_"+m.uid,"class":m.settings.classOptions,css:{display:"none"}});j.children().each(function(w){var x=d(this),s,v={};if(x.is("option")){q(x)}else{if(x.is("optgroup")){s=d("<li>");d("<span>",{text:x.attr("label")}).addClass(m.settings.classGroup).appendTo(s);s.appendTo(p);if(x.is(":disabled")){v.disabled=true}v.sub=true;q(x.find("option"),v)}}});function q(){var v=arguments[1]&&arguments[1].sub?true:false,s=arguments[1]&&arguments[1].disabled?true:false;arguments[0].each(function(x){var y=d(this),w=d("<li>"),z;if(y.is(":selected")){r.text(y.text());u=b}if(x===n-1){w.addClass("last")}if(!y.is(":disabled")&&!s){z=d("<a>",{href:"#"+y.val(),rel:y.val()}).text(y.text()).bind("click.sb touchend",function(D){if(D&&D.preventDefault){D.preventDefault()}var B=i,C=d(this),A=B.attr("id").split("_")[1];t._changeSelectbox(o,C.attr("rel"));t._closeSelectbox(o)}).bind("mouseover.sb",function(){var A=d(this);A.parent().siblings().find("a").removeClass(m.settings.classFocus);A.addClass(m.settings.classFocus)}).bind("mouseout.sb",function(){d(this).removeClass(m.settings.classFocus)});if(v){z.addClass(m.settings.classSub)}if(y.is(":selected")){z.addClass(m.settings.classFocus)}z.appendTo(w)}else{z=d("<span>",{text:y.text()}).addClass(m.settings.classDisabled);if(v){z.addClass(m.settings.classSub)}z.appendTo(w)}w.appendTo(p)})}if(!u){r.text(h.first().text())}d.data(o,e,m);l.data("uid",m.uid).bind("keydown.sb",function(z){var w=0,C=z.charCode?z.charCode:z.keyCode?z.keyCode:0,B=d(this),y=B.data("uid"),x=B.siblings("select[sb='"+y+"']").data(e),A=B.siblings(["select[sb='",y,"']"].join("")).get(0),s=B.find("ul").find("a."+x.settings.classFocus),v;switch(C){case 37:case 38:if(s.length>0){d("a",B).removeClass(x.settings.classFocus);v=s.parent().prevAll("li:has(a)").eq(0).find("a");if(v.length>0){v.addClass(x.settings.classFocus).focus();d("#sbSelector_"+y).text(t._getLabel(A,v.attr("rel")))}}break;case 39:case 40:d("a",B).removeClass(x.settings.classFocus);if(s.length>0){v=s.parent().nextAll("li:has(a)").eq(0).find("a")}else{v=B.find("ul").find("a").eq(0)}if(v.length>0){v.addClass(x.settings.classFocus).focus();d("#sbSelector_"+y).text(t._getLabel(A,v.attr("rel")))}break;case 13:if(s.length>0){t._changeSelectbox(A,s.attr("rel"))}t._closeSelectbox(A);break;case 9:if(A){x=t._getInst(A);if(x){if(s.length>0){t._changeSelectbox(A,s.attr("rel"))}t._closeSelectbox(A)}}w=parseInt(B.attr("tabindex"),10);if(!z.shiftKey){w++}else{w--}d("*[tabindex='"+w+"']").focus();break;case 27:t._closeSelectbox(A);break}z.stopPropagation();return false}).delegate("a","mouseover",function(s){d(this).addClass(m.settings.classFocus)}).delegate("a","mouseout",function(s){d(this).removeClass(m.settings.classFocus)});r.appendTo(l);p.appendTo(l);l.insertAfter(j);d("html").on("click","html",function(s){s.stopPropagation();d("select").selectbox("close")});d([".",m.settings.classHolder,", .",m.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(h){var g=this._getInst(h);if(!g){return c}d("#sbHolder_"+g.uid).remove();d.data(h,e,null);d(h).show()},_changeSelectbox:function(j,i,k){var g,h=this._getInst(j);if(k===f){k=this._getLabel(j,i)}if(h){g=this._get(h,"onChange");d("#sbSelector_"+h.uid).text(k)}d(j).val(i);if(h&&g){g.apply((h.input?h.input[0]:null),[i,h])}else{if(h&&h.input){h.input.trigger("change")}}},_enableSelectbox:function(h){var g=this._getInst(h);if(!g||!g.isDisabled){return c}d("#sbHolder_"+g.uid).removeClass(g.settings.classHolderDisabled);g.isDisabled=c;d.data(h,e,g)},_disableSelectbox:function(h){var g=this._getInst(h);if(!g||g.isDisabled){return c}d("#sbHolder_"+g.uid).addClass(g.settings.classHolderDisabled);g.isDisabled=b;d.data(h,e,g)},_optionSelectbox:function(j,g,i){var h=this._getInst(j);if(!h){return c}h.settings[g]=i;d.data(j,e,h)},_openSelectbox:function(m){var k=this._getInst(m);if(!k||k.isOpen||k.isDisabled){return}var h=d("#sbOptions_"+k.uid),l=parseInt(d(window).height(),10),j=d("#sbHolder_"+k.uid).offset(),g=d(window).scrollTop(),o=h.prev().height(),n=l-(j.top-g)-o/2,i=this._get(k,"onOpen");h.css({top:o+"px",maxHeight:(n-o)+"px"});if(k.settings.effect==="fade"){h.fadeIn(k.settings.speed)}else{h.slideDown(k.settings.speed)}d("#sbToggle_"+k.uid).addClass(k.settings.classToggleOpen);this._state[k.uid]=b;k.isOpen=b;if(i){i.apply((k.input?k.input[0]:null),[k])}d.data(m,e,k)},_closeSelectbox:function(i){var h=this._getInst(i);if(!h||!h.isOpen){return}var g=this._get(h,"onClose");if(h.settings.effect==="fade"){d("#sbOptions_"+h.uid).fadeOut(h.settings.speed)}else{d("#sbOptions_"+h.uid).slideUp(h.settings.speed)}d("#sbToggle_"+h.uid).removeClass(h.settings.classToggleOpen);this._state[h.uid]=c;h.isOpen=c;if(g){g.apply((h.input?h.input[0]:null),[h])}d.data(i,e,h)},_getLabel:function(i,h){var g=d(i).find("option[value='"+h.replace(/\'/g,"\\'")+"']").html();return g},_newInst:function(g){var h=g[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:h,input:g,uid:Math.floor(Math.random()*99999999),isOpen:c,isDisabled:c,settings:{}}},_getInst:function(h){try{return d.data(h,e)}catch(g){throw"Missing instance data for this selectbox"}},_get:function(h,g){return h.settings[g]!==f?h.settings[g]:this._defaults[g]}});d.fn.selectbox=function(h){var g=Array.prototype.slice.call(arguments,1);if(typeof h=="string"&&h=="isDisabled"){return d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this[0]].concat(g))}if(h=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this[0]].concat(g))}this.each(function(){if(typeof h=="string"){d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this].concat(g))}else{d.selectbox._attachSelectbox(this,h)}});return this};d.selectbox=new a();d.selectbox.version="0.2";d(document).on("mouseup touchend",function(h){var g=d(".sbHolder");
if(!g.is(h.target)&&g.has(h.target).length===0){d("select").selectbox("close")}})})(jQuery);